# CLAUDE.md

--使用中文

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

这是一个音频编辑器（audioediter）项目，专门用于云听文转声精修功能。系统允许运营人员对生成的语音内容进行详细的音频调整和优化。

## 核心功能与架构

### 主要模块

1. **音频精修处理模块**
   - 提供精细化的音频调整工具，用于音频细节优化
   - 由精修工具栏和文本编辑区两部分组成
   - 所有精修操作的结果都体现在最终合成的音频文件中

2. **精修工具栏功能**
   - 声音模型库：提供多种性别、年龄段和风格的音色选择
   - 分段音量调节：对特定文本分句进行独立的音量控制
   - 分段语速调节：对特定文本分句进行独立的语速调节
   - 自动化文本分句：支持基于标点符号和指定字数的两种分句逻辑
   - 插入停顿：在文本任意位置插入指定时长的停顿
   - 多音字读音修正：提供多音字读音的纠正功能
   - 插入静音：在文本任意位置插入静音片段
   - 连读处理：对选定文本片段进行强制连续播报处理
   - 数字英文读法规范：为数字和英文提供特定读法选择
   - 别名功能：专有词汇读音自定义
   - 音标功能：外文词汇音标修正
   - 特殊词表：可维护的播报规则库

3. **文本编辑区交互功能**
   - 分句文本编辑：对每个句子片段进行内容的增删改
   - 特殊指令可视化标识：以视觉符号展示所有精修操作
   - 单句独立合成与试听：针对单个句子的独立TTS合成
   - 单句删除：删除单个句子片段
   - 合成状态标识：区分"待合成"、"合成中"、"已合成"等状态
   - 插入新句：在任意位置插入新的文本输入框
   - 一键批量合成：将所有句子片段合成为完整音频
   - 一键清空：重置所有内容和设置
   - 字数统计与上限提示：实时显示字数和合成上限

### 技术要求

- 必须保持现有前端交互规则和功能不变
- 后台服务无缝替换，不改变用户体验
- 支持所有当前操作流程和使用习惯
- 基于API与运营管理后台（OMC）前端集成
- 不包含任何内置敏感词审查或过滤机制
- 独立的内容合规性管理

## 技术架构

### 云端优先架构设计
项目采用**云端 API + 本地服务**的架构：
- **云端服务**：阿里云 DashScope 作为主要 TTS 服务，提供高质量的语音合成
- **API 代理**：本地 TTS 代理服务，统一管理云端 API 调用
- **备用服务**：GPT-SoVITS 云端 API 作为语音克隆备用方案
- **智能降级**：自动检测服务状态，智能选择最优 TTS 服务

### 核心技术栈
- **前端**: Vue 3 + TypeScript + Element Plus + Vite
- **后端**: Node.js + Fastify + Redis + MySQL
- **云端 TTS**: 阿里云 DashScope API + GPT-SoVITS 云端 API
- **API 代理**: Node.js Express 代理服务
- **音频处理**: FFmpeg + fluent-ffmpeg
- **实时通信**: Socket.io WebSocket

### 系统要求
- **开发环境**: Node.js 18+ + Docker + 稳定的网络连接
- **生产环境**: 4GB+ 内存 + 1GB+ 磁盘空间 + 云端 API 密钥
- **网络要求**: 稳定的互联网连接用于云端 API 调用

## 开发指南

在开发此项目时需要注意：

1. **云端优先**：优先使用阿里云 DashScope API，GPT-SoVITS 云端 API 作为备用
2. **界面一致性**：保持文档截图中展示的页面布局和交互模式
3. **音频处理**：确保所有精修设置准确体现在最终音频输出中
4. **实时功能**：支持单句修改的即时预览和合成，延迟控制在 500ms 内
5. **状态管理**：追踪每个文本段的合成状态，支持多服务状态同步
6. **API 管理**：统一管理云端 API 调用，支持重试和降级机制
7. **性能优化**：并发处理、缓存机制、流式输出、错误处理
8. **可访问性**：为所有音频修改提供清晰的视觉指示

## 云端 TTS 集成说明

项目已迁移至云端 API 架构，主要变更包括：

### TTS 服务架构
- **主要服务**: 阿里云 DashScope API (端口 8001)
- **备用服务**: GPT-SoVITS 云端 API (端口 8051)
- **API 代理**: 本地 TTS 代理服务统一管理
- **智能降级**: 自动检测服务状态，智能选择最优服务

### 云端 API 配置
- **阿里云 DashScope**: 支持 CosyVoice 和 Sambert 模型
- **GPT-SoVITS 云端**: 支持语音克隆和合成
- **API 密钥管理**: 通过环境变量配置
- **请求代理**: 本地代理服务处理请求转发

### 文件结构
- `docker/tts-proxy/` - TTS API 代理服务
- `config/cloud-api.env.template` - 云端 API 配置模板
- `.env.cloud` - 云端 API 环境配置
- `scripts/start-cloud-services.sh` - 云端服务启动脚本

### 部署要求
- 稳定的互联网连接
- 有效的云端 API 密钥
- Docker 容器化环境
- 4GB+ 内存和 1GB+ 磁盘空间

## 文件结构说明

项目文档包括：
- `文转声精修页面功能详解.pdf` - 详细的UI/UX规范和截图
- `需求说明书.docx`/`txt.md` - 技术需求和功能规格说明

重点实现音频精修界面，打造支持专业音频内容创作工作流的综合TTS编辑平台。