# ğŸ—ï¸ Docker æ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†éŸ³é¢‘ç¼–è¾‘å™¨é¡¹ç›®çš„ Docker å®¹å™¨åŒ–æ¶æ„ï¼Œå®ç°äº†å®Œæ•´çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œä½¿ç”¨äº‘ç«¯ API æœåŠ¡æ›¿ä»£æœ¬åœ°æ¨¡å‹éƒ¨ç½²ã€‚

## ğŸ¯ æ¶æ„ç‰¹ç‚¹

- **äº‘ç«¯ä¼˜å…ˆ**: ä½¿ç”¨äº‘ç«¯ TTS API æœåŠ¡ï¼Œæ— éœ€æœ¬åœ°æ¨¡å‹éƒ¨ç½²
- **å¾®æœåŠ¡æ¶æ„**: å„æœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- **å®¹å™¨åŒ–éƒ¨ç½²**: æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­
- **ç»Ÿä¸€ä»£ç†**: ä½¿ç”¨ Nginx ä½œä¸ºåå‘ä»£ç†ï¼Œæä¾›ç»Ÿä¸€è®¿é—®å…¥å£
- **æ•°æ®æŒä¹…åŒ–**: æ•°æ®åº“å’Œç¼“å­˜æ•°æ®æŒä¹…åŒ–å­˜å‚¨

## ğŸ›ï¸ æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx åå‘ä»£ç† (80)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚                 â”‚
    â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯åº”ç”¨ â”‚    â”‚   åç«¯ API   â”‚    â”‚ TTS APIä»£ç†  â”‚
â”‚ (5173)  â”‚    â”‚   (3000)    â”‚    â”‚   (8001)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                 â”‚
                      â–¼                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
              â”‚   MySQL     â”‚          â”‚
              â”‚   (3306)    â”‚          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                      â”‚                 â”‚
                      â–¼                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
              â”‚   Redis     â”‚          â”‚
              â”‚   (6379)    â”‚          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   äº‘ç«¯ API      â”‚
                              â”‚ CosyVoice API  â”‚
                              â”‚ GPT-SoVITS API â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ³ å®¹å™¨æœåŠ¡

### 1. å‰ç«¯æœåŠ¡ (Frontend)
- **é•œåƒ**: åŸºäº Node.js 18 æ„å»º
- **ç«¯å£**: 5173
- **åŠŸèƒ½**: Vue 3 å•é¡µåº”ç”¨
- **ç‰¹æ€§**: 
  - å¼€å‘ç¯å¢ƒçƒ­é‡è½½
  - ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–æ„å»º
  - é™æ€èµ„æºæœåŠ¡

### 2. åç«¯æœåŠ¡ (Backend)
- **é•œåƒ**: åŸºäº Node.js 18 æ„å»º
- **ç«¯å£**: 3000
- **åŠŸèƒ½**: Fastify API æœåŠ¡å™¨
- **ç‰¹æ€§**:
  - RESTful API æ¥å£
  - WebSocket æ”¯æŒ
  - äº‘ç«¯ API é›†æˆ

### 3. TTS API ä»£ç†æœåŠ¡ (TTS Proxy)
- **é•œåƒ**: åŸºäº Node.js 18 æ„å»º
- **ç«¯å£**: 8001, 8051
- **åŠŸèƒ½**: äº‘ç«¯ TTS API ä»£ç†
- **ç‰¹æ€§**:
  - ç»Ÿä¸€ API æ¥å£
  - è¯·æ±‚è½¬å‘å’Œå“åº”å¤„ç†
  - é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### 4. MySQL æ•°æ®åº“
- **é•œåƒ**: mysql:8.0
- **ç«¯å£**: 3306
- **åŠŸèƒ½**: å…³ç³»å‹æ•°æ®åº“
- **ç‰¹æ€§**:
  - æ•°æ®æŒä¹…åŒ–
  - è‡ªåŠ¨åˆå§‹åŒ–
  - è¿æ¥æ± ç®¡ç†

### 5. Redis ç¼“å­˜
- **é•œåƒ**: redis:7-alpine
- **ç«¯å£**: 6379
- **åŠŸèƒ½**: å†…å­˜ç¼“å­˜å’Œä¼šè¯å­˜å‚¨
- **ç‰¹æ€§**:
  - é«˜æ€§èƒ½ç¼“å­˜
  - ä¼šè¯ç®¡ç†
  - æ¶ˆæ¯é˜Ÿåˆ—

### 6. Nginx åå‘ä»£ç†
- **é•œåƒ**: nginx:alpine
- **ç«¯å£**: 80, 443
- **åŠŸèƒ½**: åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡
- **ç‰¹æ€§**:
  - ç»Ÿä¸€è®¿é—®å…¥å£
  - SSL ç»ˆæ­¢
  - é™æ€æ–‡ä»¶æœåŠ¡

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
# äº‘ç«¯ API é…ç½®
COSYVOICE_CLOUD_API_URL=https://dashscope.aliyuncs.com/api/v1/services/aigc/text-to-speech
COSYVOICE_API_KEY=your_api_key_here
GPT_SOVITS_CLOUD_API_URL=https://api.example.com/gpt-sovits/v1
GPT_SOVITS_API_KEY=your_api_key_here

# æ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=audioediter_root
MYSQL_DATABASE=audioediter
MYSQL_USER=audioediter
MYSQL_PASSWORD=audioediter_pass

# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=3000
REDIS_URL=redis://redis:6379
```

### ç½‘ç»œé…ç½®

- **ç½‘ç»œåç§°**: audio-editor-network
- **ç½‘ç»œç±»å‹**: bridge
- **æœåŠ¡å‘ç°**: é€šè¿‡æœåŠ¡åè¿›è¡Œå†…éƒ¨é€šä¿¡

### å­˜å‚¨å·

```yaml
volumes:
  mysql_data:    # MySQL æ•°æ®æŒä¹…åŒ–
  redis_data:    # Redis æ•°æ®æŒä¹…åŒ–
  uploads:       # æ–‡ä»¶ä¸Šä¼ ç›®å½•
  temp:          # ä¸´æ—¶æ–‡ä»¶ç›®å½•
  logs:          # æ—¥å¿—æ–‡ä»¶ç›®å½•
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# æ£€æŸ¥ Docker ç¯å¢ƒ
docker --version
docker-compose --version

# åˆ›å»ºé…ç½®æ–‡ä»¶
cp config/cloud-api.env.template .env.cloud
# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½® API å¯†é’¥
```

### 2. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/docker-start.sh

# æˆ–ä½¿ç”¨ docker-compose
docker-compose up -d
```

### 3. éªŒè¯éƒ¨ç½²
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./scripts/docker-status.sh

# æµ‹è¯•æœåŠ¡åŠŸèƒ½
./scripts/docker-test.sh
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æœåŠ¡ç›‘æ§
- **å¥åº·æ£€æŸ¥**: æ¯ä¸ªæœåŠ¡éƒ½æœ‰å¥åº·æ£€æŸ¥ç«¯ç‚¹
- **çŠ¶æ€ç›‘æ§**: é€šè¿‡ `docker-compose ps` æŸ¥çœ‹æœåŠ¡çŠ¶æ€
- **èµ„æºç›‘æ§**: é€šè¿‡ `docker stats` æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ

### æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f tts-proxy

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
docker-compose logs --tail=100 -f
```

## ğŸ”’ å®‰å…¨é…ç½®

### ç½‘ç»œå®‰å…¨
- **å†…éƒ¨é€šä¿¡**: æœåŠ¡é—´é€šè¿‡å†…éƒ¨ç½‘ç»œé€šä¿¡
- **ç«¯å£æš´éœ²**: ä»…æš´éœ²å¿…è¦çš„ç«¯å£
- **é˜²ç«å¢™**: å»ºè®®é…ç½®é˜²ç«å¢™è§„åˆ™

### æ•°æ®å®‰å…¨
- **ç¯å¢ƒå˜é‡**: æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’
- **æ•°æ®åŠ å¯†**: æ•°æ®åº“è¿æ¥ä½¿ç”¨åŠ å¯†
- **è®¿é—®æ§åˆ¶**: API å¯†é’¥ç®¡ç†

## ğŸ”„ æ‰©å±•å’Œç»´æŠ¤

### æ°´å¹³æ‰©å±•
- **æ— çŠ¶æ€æœåŠ¡**: å‰ç«¯ã€åç«¯ã€TTS ä»£ç†æ”¯æŒæ°´å¹³æ‰©å±•
- **è´Ÿè½½å‡è¡¡**: Nginx æ”¯æŒè´Ÿè½½å‡è¡¡é…ç½®
- **æ•°æ®åº“é›†ç¾¤**: MySQL æ”¯æŒä¸»ä»å¤åˆ¶

### ç‰ˆæœ¬æ›´æ–°
```bash
# æ›´æ–°é•œåƒ
docker-compose pull

# é‡å¯æœåŠ¡
docker-compose up -d

# æ¸…ç†æ—§é•œåƒ
docker image prune
```

### å¤‡ä»½å’Œæ¢å¤
```bash
# å¤‡ä»½æ•°æ®åº“
docker-compose exec mysql mysqldump -u root -p audioediter > backup.sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T mysql mysql -u root -p audioediter < backup.sql
```

## ğŸ¯ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ
- ä½¿ç”¨ `docker-compose up` å¯åŠ¨å¼€å‘ç¯å¢ƒ
- å¯ç”¨çƒ­é‡è½½å’Œè°ƒè¯•æ¨¡å¼
- ä½¿ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶è¦†ç›–é»˜è®¤é…ç½®

### ç”Ÿäº§ç¯å¢ƒ
- ä½¿ç”¨ `docker-compose up -d` åå°è¿è¡Œ
- é…ç½®æ—¥å¿—è½®è½¬å’Œç›‘æ§
- è®¾ç½®èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥

### æ•…éšœæ’é™¤
- æ£€æŸ¥å®¹å™¨æ—¥å¿—: `docker-compose logs`
- éªŒè¯ç½‘ç»œè¿æ¥: `docker network ls`
- æ£€æŸ¥ç«¯å£å ç”¨: `lsof -i :ç«¯å£å·`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äº‘ç«¯ API é›†æˆæ–¹æ¡ˆ](./cloud-api-integration.md)
- [å¿«é€Ÿå¯åŠ¨æŒ‡å—](./cloud-api-quick-start.md)
- [Docker éƒ¨ç½²æŒ‡å—](./docker-setup.md)
- [æ•…éšœæ’é™¤æŒ‡å—](./troubleshooting.md)

---

*é€šè¿‡äº‘ç«¯ API æ¶æ„ï¼Œå®ç°äº†è½»é‡åŒ–ã€é«˜å¯ç”¨çš„éŸ³é¢‘ç¼–è¾‘å™¨æœåŠ¡éƒ¨ç½²ã€‚*