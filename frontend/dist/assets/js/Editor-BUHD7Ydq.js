import{m as Ke,n as u,p as W,d as fe,q as ee,c as I,o as S,b as t,s as Te,F as oe,t as re,a as v,f as he,w as b,g as L,v as Ee,x as Je,y as We,z as ie,A as ge,B as be,C as xe,D as Ne,G as E,H as qe,I as He,J as Qe,K as w,h as Se,L as Ze,M as et,N as tt,u as Ie,O as nt,e as st,r as Ve}from"./index-BgjiYeva.js";import{u as at}from"./el-overlay-BmpTTlvR.js";import{_ as _e}from"./_plugin-vue_export-helper-T9wiJ-W-.js";import{u as ot}from"./app-BefKaqKy.js";/* empty css                  *//* empty css                       */const it=Ke("audio",()=>{const g=u([]),D=u(""),f=u(!1),_=u(0),$=u(0),k=u(1),j=W(()=>g.value.find(n=>n.id===D.value)),P=W(()=>g.value.length>0),R=W(()=>g.value.reduce((n,e)=>n+(e.duration||0),0)),N=n=>{const e={...n,id:Date.now().toString(),isPlaying:!1,isSynthesizing:!1,isSegmented:!1};return g.value.push(e),D.value||(D.value=e.id),e.id},y=n=>{var l;const e=g.value.findIndex(d=>d.id===n);e>-1&&(g.value.splice(e,1),D.value===n&&(D.value=((l=g.value[0])==null?void 0:l.id)||""))},z=(n,e)=>{const l=g.value.find(d=>d.id===n);l&&Object.assign(l,e)},F=n=>{D.value=n},U=n=>{g.value.forEach(l=>{l.id!==n&&(l.isPlaying=!1)});const e=g.value.find(l=>l.id===n);e&&(e.isPlaying=!0,f.value=!0)},O=n=>{const e=g.value.find(l=>l.id===n);e&&(e.isPlaying=!1,f.value=!1)},h=()=>{g.value.forEach(n=>{n.isPlaying=!1}),f.value=!1,_.value=0},C=()=>{g.value=[],D.value="",f.value=!1,_.value=0,$.value=0},Y=(n,e,l)=>{const d=g.value.find(m=>m.id===n);d&&(d.segments=e,d.isSegmented=!0,d.segmentMethod=l)},J=n=>{const e=g.value.find(l=>l.id===n);e&&(e.segments=void 0,e.isSegmented=!1,e.segmentMethod=void 0)},X=(n,e,l)=>{const d=g.value.find(m=>m.id===n);if(d&&d.segments){const m=d.segments.find(A=>A.id===e);m&&(m.text=l,d.text=d.segments.map(A=>A.text).join(" "))}},H=(n,e)=>{const l=g.value.find(d=>d.id===n);if(l&&l.segments){const d=l.segments.findIndex(m=>m.id===e);d>-1&&(l.segments.splice(d,1),l.text=l.segments.map(m=>m.text).join(" "))}},Q=(n,e)=>{const l=g.value.find(d=>d.id===n);l&&l.segments&&(l.segments.push(e),l.text=l.segments.map(d=>d.text).join(" "))},te=(n,e,l,d=1)=>{const m=g.value.find(A=>A.id===n);if(m&&m.isSegmented){m.gaps||(m.gaps=[]);const G={id:`gap_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,beforeSegmentId:e,afterSegmentId:l,duration:d,isSelected:!1};m.gaps.push(G)}};return{tracks:g,currentTrackId:D,isPlaying:f,currentTime:_,duration:$,volume:k,currentTrack:j,hasTracks:P,totalDuration:R,addTrack:N,removeTrack:y,updateTrack:z,setCurrentTrack:F,playTrack:U,pauseTrack:O,stopAllTracks:h,clearTracks:C,segmentTrack:Y,unsegmentTrack:J,updateSegmentText:X,removeSegment:H,addSegment:Q,addGap:te,updateGapDuration:(n,e,l)=>{const d=g.value.find(m=>m.id===n);if(d&&d.gaps){const m=d.gaps.find(A=>A.id===e);m&&(m.duration=Math.max(0,l))}},removeGap:(n,e)=>{const l=g.value.find(d=>d.id===n);if(l&&l.gaps){const d=l.gaps.findIndex(m=>m.id===e);d>-1&&l.gaps.splice(d,1)}},selectGap:(n,e)=>{const l=g.value.find(d=>d.id===n);if(l&&l.gaps){l.gaps.forEach(m=>m.isSelected=!1);const d=l.gaps.find(m=>m.id===e);d&&(d.isSelected=!0)}},initializeGaps:n=>{const e=g.value.find(l=>l.id===n);if(e&&e.isSegmented&&e.segments&&e.segments.length>1){e.gaps||(e.gaps=[]);for(let l=0;l<e.segments.length-1;l++){const d=e.segments[l].id,m=e.segments[l+1].id;e.gaps.find(G=>G.beforeSegmentId===d&&G.afterSegmentId===m)||te(n,d,m,1)}}}}}),lt={class:"timeline-segments"},dt=["onClick","onDblclick"],ct={class:"sentence-content"},ut={key:0,class:"sentence-edit"},rt={key:1},pt={class:"sentence-text"},mt={class:"sentence-info"},vt={class:"sentence-duration"},gt={class:"sentence-index"},ft={key:0,class:"sentence-actions"},ht=["onClick"],_t={class:"gap-indicator"},yt={class:"gap-duration"},xt={key:0,class:"gap-editor"},St={class:"gap-header"},$t={class:"gap-actions"},kt={class:"gap-content"},Ft={class:"gap-settings"},Ct={class:"gap-duration-control"},Tt={class:"gap-duration-display"},bt={key:1,class:"empty-state"},It={name:"TimelineSegments"},Vt=fe({...It,props:{segments:{},gaps:{},totalDuration:{},selectedSegmentId:{},playingSegmentId:{},selectedGapId:{},tracks:{}},emits:["select-segment","play-segment","edit-segment","add-text","update-segment-text","delete-segment","add-sentence-after","select-gap","update-gap-duration","remove-gap","open-voice-editor"],setup(g,{emit:D}){const f=g,_=D,$=u(""),k=u(""),j=u(null),P=u(-1),R=u(),N=u(""),y=u(null),z=u(""),F=u(""),U=u(null),O=100,h=W(()=>f.totalDuration),C=W(()=>{const n=h.value*O;return Math.max(n,1200)});ee(()=>f.selectedSegmentId,n=>{$.value=n||""}),ee(()=>f.playingSegmentId,n=>{k.value=n||""}),ee(()=>f.segments,n=>{try{console.log("TimelineSegments - segments changed:",n.length,"segments"),n&&n.length>0&&console.log("TimelineSegments - first segment:",n[0])}catch(e){console.error("TimelineSegments - error processing segments:",e)}},{immediate:!0,deep:!0}),ee(()=>$.value,n=>{if(n){const e=f.segments.find(l=>l.id===n);e&&(!e.text||e.text.trim()==="")&&J(e)}});const Y=n=>{$.value=n.id,j.value=n,P.value=f.segments.findIndex(e=>e.id===n.id),_("select-segment",n)},J=n=>{z.value=n.id,F.value=n.text,setTimeout(()=>{U.value&&(U.value.focus(),U.value.select())},50)},X=()=>{if(z.value){const n=F.value.trim();n===""?(_("delete-segment",z.value),$.value="",j.value=null,P.value=-1):_("update-segment-text",z.value,n),z.value="",F.value=""}},H=()=>{z.value="",F.value=""},Q=()=>{y.value&&_("update-gap-duration",y.value.id,y.value.duration)},te=n=>{_("remove-gap",n),N.value="",y.value=null},le=n=>{const e=`gap_${n}`;N.value=e,$.value="",j.value=null,P.value=-1;const l={id:e,index:n,duration:se(n)};y.value=l},se=n=>{const e=f.gaps.find(l=>{var d;return l.beforeSegmentId===((d=f.segments[n])==null?void 0:d.id)});return e?e.duration:1},de=n=>{const e=f.segments[n];e&&_("add-sentence-after",e.id,n)},ce=n=>{_("delete-segment",n)};return(n,e)=>{const l=Ne,d=he,m=Ee,A=Je,G=We;return S(),I("div",lt,[e[11]||(e[11]=t("div",{class:"hint-text"}," 提示：点击选中句子，在下方可编辑相关语音配置；点击句子间的间隔可以调整间隔时间 ",-1)),t("div",{class:"sentences-timeline",ref_key:"timelineContainer",ref:R},[t("div",{class:"timeline-content",style:Te({width:`${C.value}px`})},[e[6]||(e[6]=t("div",{class:"timeline-line"},null,-1)),(S(!0),I(oe,null,re(f.segments,(T,c)=>(S(),I(oe,{key:T.id},[t("div",{class:ge(["sentence-block",{active:$.value===T.id,playing:k.value===T.id,editing:z.value===T.id}]),onClick:a=>Y(T),onDblclick:a=>J(T)},[t("div",ct,[z.value===T.id?(S(),I("div",ut,[v(l,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=a=>F.value=a),type:"textarea",rows:2,size:"small",placeholder:"输入句子内容...",onBlur:X,onKeydown:[be(xe(X,["prevent"]),["enter"]),be(H,["escape"])],ref_for:!0,ref_key:"editInput",ref:U,class:"sentence-edit-input"},null,8,["modelValue","onKeydown"])])):(S(),I("div",rt,[t("div",pt,E(T.text),1),t("div",mt,[t("span",vt,E(T.duration)+"s",1),t("span",gt,"#"+E(c+1),1)])]))]),$.value===T.id&&z.value!==T.id?(S(),I("div",ft,[v(d,{onClick:xe(a=>de(c),["stop"]),type:"primary",size:"small",icon:"Plus",circle:"",class:"action-btn add-btn",title:"在此句后添加新句子"},null,8,["onClick"]),v(d,{onClick:xe(a=>ce(T.id),["stop"]),type:"danger",size:"small",icon:"Delete",circle:"",class:"action-btn delete-btn",title:"删除此句子"},null,8,["onClick"])])):ie("",!0)],42,dt),c<f.segments.length-1?(S(),I("div",{key:`gap_${T.id}_${c}`,class:ge(["gap-control-block",{active:N.value===`gap_${c}`}]),onClick:a=>le(c)},[t("div",_t,[e[4]||(e[4]=t("div",{class:"gap-line"},null,-1)),t("div",yt,E(se(c))+"s",1)])],10,ht)):ie("",!0)],64))),128)),t("div",{class:"timeline-end",style:Te({left:`${C.value-50}px`})},[...e[5]||(e[5]=[t("div",{class:"end-line"},null,-1)])],4)],4)],512),y.value?(S(),I("div",xt,[t("div",St,[e[8]||(e[8]=t("h3",null,"间隔设置",-1)),t("div",$t,[v(d,{onClick:e[1]||(e[1]=T=>te(y.value.id)),type:"danger",size:"small",icon:"Delete"},{default:b(()=>[...e[7]||(e[7]=[L(" 删除间隔 ",-1)])]),_:1})])]),t("div",kt,[t("div",Ft,[e[10]||(e[10]=t("label",null,"间隔时长：",-1)),t("div",Ct,[v(m,{modelValue:y.value.duration,"onUpdate:modelValue":e[2]||(e[2]=T=>y.value.duration=T),min:0,max:10,step:.1,"format-tooltip":T=>`${T}s`,onChange:Q,class:"gap-slider"},null,8,["modelValue","format-tooltip"]),t("div",Tt,[v(A,{modelValue:y.value.duration,"onUpdate:modelValue":e[3]||(e[3]=T=>y.value.duration=T),min:0,max:10,step:.1,precision:1,size:"small",onChange:Q,class:"gap-duration-input"},null,8,["modelValue"]),e[9]||(e[9]=t("span",{class:"gap-unit"},"秒",-1))])])])])])):(S(),I("div",bt,[v(G,{description:"请点击上方的句子或间隔进行编辑"})]))])}}}),Et=_e(Vt,[["__scopeId","data-v-4c44ff14"]]),Nt={class:"text-input-area"},zt={class:"input-container"},Dt={class:"action-container"},Gt={name:"TextInputArea"},Pt=fe({...Gt,emits:["start-segmentation"],setup(g,{emit:D}){const f=D,_=u(""),$=j=>{_.value=j},k=()=>{_.value.trim()&&f("start-segmentation",_.value.trim())};return(j,P)=>{const R=Ne,N=he;return S(),I("div",Nt,[t("div",zt,[v(R,{modelValue:_.value,"onUpdate:modelValue":P[0]||(P[0]=y=>_.value=y),type:"textarea",rows:8,placeholder:"输入文本区域",class:"text-input",onInput:$},null,8,["modelValue"])]),t("div",Dt,[v(N,{onClick:k,disabled:!_.value.trim(),class:"start-button"},{default:b(()=>[...P[1]||(P[1]=[L(" 开始分句 ",-1)])]),_:1},8,["disabled"])])])}}}),wt=_e(Pt,[["__scopeId","data-v-47f06a80"]]),Ut={class:"sentence-voice-editor"},Mt={class:"content-display-area"},jt={class:"content-header"},At={class:"content-info"},Bt={class:"sentence-index"},Lt={class:"sentence-duration"},Rt=["onClick","onMouseenter","onMouseleave"],Ot={class:"voice-controls"},Xt={class:"control-section"},Yt={class:"section-header"},Kt={class:"current-voice"},Jt={class:"voice-avatar"},Wt=["src","alt"],qt={class:"voice-info"},Ht={class:"voice-name"},Qt={class:"voice-category"},Zt={class:"control-section"},en={class:"section-header"},tn={class:"value-display"},nn={class:"control-section"},sn={class:"section-header"},an={class:"value-display"},on={class:"control-section"},ln={class:"section-header"},dn={class:"value-display"},cn={class:"control-section"},un={class:"section-header"},rn={key:0,class:"pause-control"},pn={class:"pause-info"},mn={class:"pause-duration"},vn={class:"duration-display"},gn={key:0,class:"control-section"},fn={class:"section-header"},hn={class:"polyphone-selection"},_n={class:"selected-char"},yn={class:"pronunciation-options"},xn={class:"pronunciation-item"},Sn={class:"pinyin"},$n={class:"tone"},kn={class:"meaning"},Fn={class:"ssml-preview"},Cn={class:"section-header"},Tn={class:"ssml-content"},bn={class:"voice-selection-dialog"},In={class:"voice-grid"},Vn=["onClick"],En={class:"voice-avatar"},Nn=["src","alt"],zn={class:"voice-name"},Dn={class:"voice-description"},Gn={class:"dialog-footer"},Pn={name:"SentenceVoiceEditor"},wn=fe({...Pn,props:{sentenceText:{},sentenceIndex:{},sentenceDuration:{},initialVoice:{},initialVolume:{default:1},initialSpeed:{default:1},initialPitch:{default:1}},emits:["update-ssml","update-voice","update-volume","update-speed","update-pitch"],setup(g,{emit:D}){const f=g,_=D,$=u(),k=u(null),j=u(null),P=u(!1),R=u("classical"),N=u(!1),y=u(""),z=u(1),F=u(f.initialVoice||te()),U=u(f.initialVolume),O=u(f.initialSpeed),h=u(f.initialPitch),C=u([]),Y=u([]),J=u([]),X=W(()=>f.sentenceText.split("")),H=W(()=>{let c='<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="zh-CN">';c+=`<voice name="${F.value.ssmlName}">`,c+=`<prosody rate="${O.value}" pitch="${h.value}" volume="${Math.round(U.value*100)}%">`;let a="";for(let x=0;x<X.value.length;x++){const M=X.value[x],K=Y.value.find(ne=>ne.charIndex===x);K?a+=`<phoneme alphabet="pinyin" ph="${K.pinyin}">${M}</phoneme>`:a+=M;const ae=C.value.find(ne=>ne.charIndex===x);ae&&(a+=`<break time="${ae.duration}s"/>`)}return c+=a,c+="</prosody>",c+="</voice>",c+="</speak>",c}),Q=u([{id:"classical",name:"古典人物",voices:[{id:"caocao",name:"曹操",category:"古典人物",avatar:"https://via.placeholder.com/60x60/4A90E2/FFFFFF?text=曹",description:"雄浑有力，适合历史题材",ssmlName:"zh-CN-XiaoxiaoNeural"},{id:"liubang",name:"刘邦",category:"古典人物",avatar:"https://via.placeholder.com/60x60/7ED321/FFFFFF?text=刘",description:"威严庄重，帝王风范",ssmlName:"zh-CN-YunxiNeural"},{id:"zhugeliang",name:"诸葛亮",category:"古典人物",avatar:"https://via.placeholder.com/60x60/F5A623/FFFFFF?text=诸",description:"智慧深沉，谋士风范",ssmlName:"zh-CN-YunyangNeural"}]},{id:"modern",name:"现代人物",voices:[{id:"zhichu",name:"知初",category:"现代人物",avatar:"https://via.placeholder.com/60x60/50E3C2/FFFFFF?text=知",description:"清新自然，适合日常对话",ssmlName:"zh-CN-XiaoxiaoNeural"},{id:"zhimei",name:"知美",category:"现代人物",avatar:"https://via.placeholder.com/60x60/BD10E0/FFFFFF?text=美",description:"温柔甜美，适合情感表达",ssmlName:"zh-CN-XiaohanNeural"},{id:"zhiwen",name:"知文",category:"现代人物",avatar:"https://via.placeholder.com/60x60/B8E986/FFFFFF?text=文",description:"文雅知性，适合知识讲解",ssmlName:"zh-CN-YunxiNeural"}]},{id:"special",name:"特色音色",voices:[{id:"robot",name:"机器人",category:"特色音色",avatar:"https://via.placeholder.com/60x60/9013FE/FFFFFF?text=机",description:"科技感十足，未来风格",ssmlName:"zh-CN-YunyangNeural"},{id:"child",name:"儿童",category:"特色音色",avatar:"https://via.placeholder.com/60x60/417505/FFFFFF?text=童",description:"天真可爱，适合儿童内容",ssmlName:"zh-CN-XiaoxiaoNeural"},{id:"elder",name:"长者",category:"特色音色",avatar:"https://via.placeholder.com/60x60/F8E71C/FFFFFF?text=长",description:"慈祥温和，适合故事讲述",ssmlName:"zh-CN-YunxiNeural"}]}]);function te(){return Q.value[0].voices[0]}function le(c){const a=["char"];return c===k.value&&a.push("selected"),c===j.value&&a.push("hovered"),C.value.some(K=>K.charIndex===c)&&a.push("has-pause"),Y.value.some(K=>K.charIndex===c)&&a.push("has-pronunciation"),a.join(" ")}function se(c){k.value=c;const a=X.value[c],x=n(a);if(x&&x.length>1){J.value=x,N.value=!0;const M=Y.value.find(K=>K.charIndex===c);y.value=M?M.pinyin:x[0].pinyin}else N.value=!1}function de(c){j.value=c}function ce(c){j.value=null}function n(c){return{的:[{pinyin:"de",tone:"轻声",meaning:"助词"},{pinyin:"di",tone:"二声",meaning:"目的"},{pinyin:"di",tone:"四声",meaning:"的确"}],了:[{pinyin:"le",tone:"轻声",meaning:"完成"},{pinyin:"liao",tone:"三声",meaning:"了解"}],着:[{pinyin:"zhe",tone:"轻声",meaning:"进行"},{pinyin:"zhao",tone:"二声",meaning:"着急"},{pinyin:"zhuo",tone:"二声",meaning:"穿着"}],和:[{pinyin:"he",tone:"二声",meaning:"和谐"},{pinyin:"he",tone:"四声",meaning:"附和"},{pinyin:"huo",tone:"二声",meaning:"和面"}]}[c]||null}function e(){k.value!==null&&y.value&&(Y.value=Y.value.filter(c=>c.charIndex!==k.value),Y.value.push({charIndex:k.value,pinyin:y.value}),G())}function l(){k.value!==null&&(C.value=C.value.filter(c=>c.charIndex!==k.value),C.value.push({charIndex:k.value,duration:z.value}),G(),w.success(`在"${X.value[k.value]}"后添加了${z.value}秒停顿`))}function d(c){F.value=c}function m(){_("update-voice",F.value),P.value=!1,G(),w.success(`已切换到${F.value.name}音色`)}function A(c){R.value=c}function G(){_("update-ssml",H.value)}function T(){navigator.clipboard.writeText(H.value).then(()=>{w.success("SSML已复制到剪贴板")}).catch(()=>{w.error("复制失败")})}return ee(()=>f.sentenceText,()=>{C.value=[],Y.value=[],k.value=null,N.value=!1,G()}),ee(U,c=>{_("update-volume",c),G()}),ee(O,c=>{_("update-speed",c),G()}),ee(h,c=>{_("update-pitch",c),G()}),G(),(c,a)=>{const x=he,M=Ee,K=Ze,ae=qe,ne=et,pe=He,ye=Qe;return S(),I("div",Ut,[t("div",Mt,[t("div",jt,[a[10]||(a[10]=t("h3",null,"句子内容",-1)),t("div",At,[t("span",Bt,"句子 #"+E(c.sentenceIndex+1),1),t("span",Lt,E(c.sentenceDuration)+"s",1)])]),t("div",{class:"content-text",ref_key:"contentTextRef",ref:$},[(S(!0),I(oe,null,re(X.value,(r,B)=>(S(),I("span",{key:B,class:ge(le(B)),onClick:ue=>se(B),onMouseenter:ue=>de(B),onMouseleave:ue=>ce()},E(r),43,Rt))),128))],512)]),t("div",Ot,[t("div",Xt,[t("div",Yt,[a[12]||(a[12]=t("label",null,"语音音色",-1)),v(x,{onClick:a[0]||(a[0]=r=>P.value=!0),type:"primary",size:"small",icon:"User"},{default:b(()=>[...a[11]||(a[11]=[L(" 更换音色 ",-1)])]),_:1})]),t("div",Kt,[t("div",Jt,[t("img",{src:F.value.avatar,alt:F.value.name},null,8,Wt)]),t("div",qt,[t("div",Ht,E(F.value.name),1),t("div",Qt,E(F.value.category),1)])])]),t("div",Zt,[t("div",en,[a[13]||(a[13]=t("label",null,"音量",-1)),t("span",tn,E(Math.round(U.value*100))+"%",1)]),v(M,{modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=r=>U.value=r),min:0,max:1,step:.01,"format-tooltip":r=>`${Math.round(r*100)}%`,onChange:G},null,8,["modelValue","format-tooltip"])]),t("div",nn,[t("div",sn,[a[14]||(a[14]=t("label",null,"语速",-1)),t("span",an,E(O.value)+"x",1)]),v(M,{modelValue:O.value,"onUpdate:modelValue":a[2]||(a[2]=r=>O.value=r),min:.5,max:5,step:.1,"format-tooltip":r=>`${r}x`,onChange:G},null,8,["modelValue","format-tooltip"])]),t("div",on,[t("div",ln,[a[15]||(a[15]=t("label",null,"音调",-1)),t("span",dn,E(h.value)+"x",1)]),v(M,{modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=r=>h.value=r),min:.5,max:2,step:.1,"format-tooltip":r=>`${r}x`,onChange:G},null,8,["modelValue","format-tooltip"])]),t("div",cn,[t("div",un,[a[17]||(a[17]=t("label",null,"字后停顿",-1)),v(x,{onClick:l,type:"success",size:"small",icon:"Plus",disabled:!k.value},{default:b(()=>[...a[16]||(a[16]=[L(" 添加停顿 ",-1)])]),_:1},8,["disabled"])]),k.value!==null?(S(),I("div",rn,[t("div",pn,[t("span",null,'在 "'+E(X.value[k.value])+'" 后添加停顿',1)]),t("div",mn,[a[18]||(a[18]=t("label",null,"停顿时长：",-1)),v(M,{modelValue:z.value,"onUpdate:modelValue":a[4]||(a[4]=r=>z.value=r),min:.1,max:3,step:.1,"format-tooltip":r=>`${r}s`},null,8,["modelValue","format-tooltip"]),t("span",vn,E(z.value)+"s",1)])])):ie("",!0)]),N.value?(S(),I("div",gn,[t("div",fn,[a[20]||(a[20]=t("label",null,"多音字选择",-1)),v(x,{onClick:a[5]||(a[5]=r=>N.value=!1),type:"info",size:"small",icon:"Close"},{default:b(()=>[...a[19]||(a[19]=[L(" 关闭 ",-1)])]),_:1})]),t("div",hn,[t("div",_n,[a[21]||(a[21]=L(" 选中字符：",-1)),t("strong",null,E(X.value[k.value]),1)]),t("div",yn,[v(ae,{modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=r=>y.value=r),onChange:e},{default:b(()=>[(S(!0),I(oe,null,re(J.value,r=>(S(),Se(K,{key:r.pinyin,label:r.pinyin,class:"pronunciation-option"},{default:b(()=>[t("div",xn,[t("span",Sn,E(r.pinyin),1),t("span",$n,E(r.tone),1),t("span",kn,E(r.meaning),1)])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])])])):ie("",!0)]),t("div",Fn,[t("div",Cn,[a[23]||(a[23]=t("label",null,"SSML标记预览",-1)),v(x,{onClick:T,type:"info",size:"small",icon:"CopyDocument"},{default:b(()=>[...a[22]||(a[22]=[L(" 复制 ",-1)])]),_:1})]),t("div",Tn,[t("pre",null,E(H.value),1)])]),v(ye,{modelValue:P.value,"onUpdate:modelValue":a[9]||(a[9]=r=>P.value=r),title:"选择语音音色",width:"800px","close-on-click-modal":!1},{footer:b(()=>[t("div",Gn,[v(x,{onClick:a[8]||(a[8]=r=>P.value=!1)},{default:b(()=>[...a[24]||(a[24]=[L("取消",-1)])]),_:1}),v(x,{type:"primary",onClick:m},{default:b(()=>[...a[25]||(a[25]=[L("确定",-1)])]),_:1})])]),default:b(()=>[t("div",bn,[v(pe,{modelValue:R.value,"onUpdate:modelValue":a[7]||(a[7]=r=>R.value=r),onTabChange:A},{default:b(()=>[(S(!0),I(oe,null,re(Q.value,r=>(S(),Se(ne,{key:r.id,label:r.name,name:r.id},{default:b(()=>[t("div",In,[(S(!0),I(oe,null,re(r.voices,B=>(S(),I("div",{key:B.id,class:ge(["voice-item",{selected:B.id===F.value.id}]),onClick:ue=>d(B)},[t("div",En,[t("img",{src:B.avatar,alt:B.name},null,8,Nn)]),t("div",zn,E(B.name),1),t("div",Dn,E(B.description),1)],10,Vn))),128))])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}}),Un=_e(wn,[["__scopeId","data-v-dd5e63ca"]]),Mn={class:"editor"},jn={class:"editor-container"},An={class:"top-toolbar"},Bn={class:"toolbar-right"},Ln={class:"main-editor"},Rn={class:"timeline-container"},On={key:0,class:"text-input-stage"},Xn={key:1,class:"segments-timeline-view"},Yn=fe({__name:"Editor",setup(g){const D=it(),f=at(),_=ot();u(!1),u(null);const $=u("input"),k=u(!1),j=u("");u(!1);const P=u(!1),R=u(null),N=u(""),y=u(-1),z=u(""),F=u(""),U=u(null),O=u(!1),h=u(null),{tracks:C,currentTrackId:Y,hasTracks:J,currentTrack:X,addTrack:H,removeTrack:Q,setCurrentTrack:te,playTrack:le,clearTracks:se,segmentTrack:de,unsegmentTrack:ce,updateSegmentText:n,removeSegment:e,addSegment:l,addGap:d,updateGapDuration:m,removeGap:A,selectGap:G,initializeGaps:T}=D,{currentProject:c,saveProject:a}=f,x=W(()=>{const o=[];let i=0;return console.log("Editor - timelineSegments computed, tracks:",C.length),C.forEach(s=>{var p;console.log("Editor - processing track:",s.id,"isSegmented:",s.isSegmented,"segments:",(p=s.segments)==null?void 0:p.length),s.isSegmented&&s.segments?s.segments.forEach((V,me)=>{const Z=V.duration||3;o.push({...V,startTime:i,endTime:i+Z,duration:Z,isPlaying:s.isPlaying,audioUrl:s.audioUrl,voice:s.voice,speed:s.speed,pitch:s.pitch}),i+=Z}):(o.push({id:s.id,text:s.text,startTime:i,endTime:i+(s.duration||0),duration:s.duration||0,isPlaying:s.isPlaying,audioUrl:s.audioUrl,voice:s.voice,speed:s.speed,pitch:s.pitch,startIndex:0,endIndex:s.text.length,type:"sentence"}),i+=s.duration||0)}),console.log("Editor - timelineSegments result:",o.length,"segments"),o}),M=W(()=>{const o=[];let i=0;return console.log("Editor - timelineGaps computed, tracks:",C.length),C.forEach(s=>{var p;console.log("Editor - processing track for gaps:",s.id,"isSegmented:",s.isSegmented,"gaps:",(p=s.gaps)==null?void 0:p.length),s.isSegmented&&s.segments&&s.gaps&&s.gaps.forEach((V,me)=>{const Z=s.segments.find(q=>q.id===V.beforeSegmentId),ve=s.segments.find(q=>q.id===V.afterSegmentId);if(Z&&ve){const q=i+(Z.duration||3);o.push({...V,startTime:q,endTime:q+V.duration})}})}),console.log("Editor - timelineGaps result:",o.length,"gaps"),o}),K=W(()=>{const o=x.value.reduce((p,V)=>p+V.duration,0),i=M.value.reduce((p,V)=>p+V.duration,0),s=o+i;return console.log("Editor - totalTimelineDuration:",s,"segments:",x.value,"gaps:",M.value),s}),ae=async()=>{if(!c){w.warning("请先创建或选择项目");return}try{await a(c),w.success("项目保存成功")}catch(o){console.error("保存项目失败:",o),w.error("保存项目失败")}},ne=async()=>{if(!c){w.warning("请先创建或选择项目");return}try{const o=await f.exportProject(c.id),i=new Blob([JSON.stringify(o)],{type:"application/json"}),s=URL.createObjectURL(i),p=document.createElement("a");p.href=s,p.download=`${c.name}.json`,p.click(),URL.revokeObjectURL(s),w.success("项目导出成功")}catch(o){console.error("导出项目失败:",o),w.error("导出项目失败")}},pe=o=>{R.value=o,N.value=o.id,y.value=x.value.findIndex(i=>i.id===o.id),P.value=!0},ye=o=>{const i=x.value.find(s=>s.id===o);i&&(z.value=o,w.info(`播放分句: ${i.text}`))},r=o=>{const i=x.value.find(s=>s.id===o);i&&pe(i)},B=o=>{w.info(`在位置 ${o.toFixed(1)}s 添加文字功能开发中...`)},ue=(o,i)=>{const s=C.find(p=>p.isSegmented&&p.segments);if(s&&s.segments){const p=s.segments.find(V=>V.id===o);p&&(p.text=i,s.text=s.segments.map(V=>V.text).join(" "),w.success("句子内容已更新"))}},ze=o=>{const i=C.find(s=>s.isSegmented&&s.segments);if(i&&i.segments){const s=i.segments.findIndex(p=>p.id===o);s>-1&&(i.segments.splice(s,1),i.text=i.segments.map(p=>p.text).join(" "),N.value===o&&(N.value="",R.value=null,y.value=-1),w.success("句子已删除"),i.segments.length===0&&($.value="input",w.info("所有句子已删除，返回文本输入阶段")))}},De=o=>{F.value=o.id,U.value=o,N.value="",R.value=null,y.value=-1},Ge=(o,i)=>{const s=C.find(p=>p.isSegmented&&p.gaps);s&&s.gaps&&s.gaps.find(V=>V.id===o)&&(D.updateGapDuration(s.id,o,i),w.success("间隔时长已更新"))},Pe=o=>{const i=C.find(s=>s.isSegmented&&s.gaps);i&&i.gaps&&(D.removeGap(i.id,o),F.value===o&&(F.value="",U.value=null),w.success("间隔已删除"))},we=(o,i)=>{const s=C.find(p=>p.isSegmented&&p.segments);if(s&&s.segments){const p={id:`segment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:"",startIndex:0,endIndex:0,type:"sentence"},V=i+1;s.segments.splice(V,0,p),D.initializeGaps(s.id),N.value=p.id,w.success("新句子已添加，请编辑内容")}},Ue=o=>{h.value=o,O.value=!0},Me=()=>{O.value=!1,h.value=null},je=o=>{const i={zhichu:{id:"zhichu",name:"知初",category:"现代人物",avatar:"https://via.placeholder.com/60x60/50E3C2/FFFFFF?text=知",description:"清新自然，适合日常对话",ssmlName:"zh-CN-XiaoxiaoNeural"},zhimei:{id:"zhimei",name:"知美",category:"现代人物",avatar:"https://via.placeholder.com/60x60/BD10E0/FFFFFF?text=美",description:"温柔甜美，适合情感表达",ssmlName:"zh-CN-XiaohanNeural"},zhiwen:{id:"zhiwen",name:"知文",category:"现代人物",avatar:"https://via.placeholder.com/60x60/B8E986/FFFFFF?text=文",description:"文雅知性，适合知识讲解",ssmlName:"zh-CN-YunxiNeural"}};return i[o||"zhichu"]||i.zhichu},Ae=o=>{if(C){const i=C.find(s=>s.id===(o==null?void 0:o.id)||s.segments&&s.segments.some(p=>p.id===(o==null?void 0:o.id)));return(i==null?void 0:i.volume)||1}return 1},Be=o=>{console.log("SSML更新:",o),h.value&&(h.value.ssml=o)},Le=o=>{console.log("音色更新:",o),h.value&&(h.value.voice=o.id)},Re=o=>{console.log("音量更新:",o),h.value&&(h.value.volume=o)},Oe=o=>{console.log("语速更新:",o),h.value&&(h.value.speed=o)},Xe=o=>{console.log("音调更新:",o),h.value&&(h.value.pitch=o)},Ye=o=>{j.value=o,k.value=!0};return tt(()=>{_.init()}),(o,i)=>{var ve,q,$e,ke,Fe;const s=he,p=nt,V=Ve("Document"),me=st,Z=Ve("Download");return S(),I("div",Mn,[t("div",jn,[t("div",An,[i[8]||(i[8]=t("div",{class:"toolbar-left"},[t("h2",{class:"app-title"},"音频编辑器")],-1)),t("div",Bn,[v(p,null,{default:b(()=>[v(s,{type:$.value==="input"?"primary":"default",onClick:i[0]||(i[0]=Ce=>$.value="input"),icon:"Edit"},{default:b(()=>[...i[3]||(i[3]=[L(" 文本输入 ",-1)])]),_:1},8,["type"]),v(s,{type:$.value==="timeline"?"primary":"default",onClick:i[1]||(i[1]=Ce=>$.value="timeline"),icon:"Grid",disabled:!Ie(J)},{default:b(()=>[...i[4]||(i[4]=[L(" 分句视图 ",-1)])]),_:1},8,["type","disabled"]),v(s,{type:$.value==="tracks"?"primary":"default",onClick:i[2]||(i[2]=Ce=>$.value="tracks"),icon:"List",disabled:!Ie(J)},{default:b(()=>[...i[5]||(i[5]=[L(" 轨道视图 ",-1)])]),_:1},8,["type","disabled"])]),_:1}),v(s,{onClick:ae},{default:b(()=>[v(me,null,{default:b(()=>[v(V)]),_:1}),i[6]||(i[6]=L(" 保存 ",-1))]),_:1}),v(s,{type:"primary",onClick:ne},{default:b(()=>[v(me,null,{default:b(()=>[v(Z)]),_:1}),i[7]||(i[7]=L(" 导出 ",-1))]),_:1})])]),t("div",Ln,[t("div",Rn,[$.value==="input"?(S(),I("div",On,[v(wt,{onStartSegmentation:Ye})])):$.value==="timeline"?(S(),I("div",Xn,[v(Et,{segments:x.value,gaps:M.value,"total-duration":K.value,"selected-segment-id":N.value,"playing-segment-id":z.value,"selected-gap-id":F.value,onSelectSegment:pe,onPlaySegment:ye,onEditSegment:r,onAddText:B,onUpdateSegmentText:ue,onDeleteSegment:ze,onAddSentenceAfter:we,onSelectGap:De,onUpdateGapDuration:Ge,onRemoveGap:Pe,onOpenVoiceEditor:Ue},null,8,["segments","gaps","total-duration","selected-segment-id","playing-segment-id","selected-gap-id"])])):ie("",!0)])])]),O.value?(S(),Se(Un,{key:0,"sentence-text":((ve=h.value)==null?void 0:ve.text)||"","sentence-index":y.value,"sentence-duration":((q=h.value)==null?void 0:q.duration)||0,"initial-voice":je(($e=h.value)==null?void 0:$e.voice),"initial-volume":Ae(h.value),"initial-speed":((ke=h.value)==null?void 0:ke.speed)||1,"initial-pitch":((Fe=h.value)==null?void 0:Fe.pitch)||1,onUpdateSsml:Be,onUpdateVoice:Le,onUpdateVolume:Re,onUpdateSpeed:Oe,onUpdatePitch:Xe,onClose:Me},null,8,["sentence-text","sentence-index","sentence-duration","initial-voice","initial-volume","initial-speed","initial-pitch"])):ie("",!0)])}}}),Zn=_e(Yn,[["__scopeId","data-v-0aa728f5"]]);export{Zn as default};
