import{m as j,n as d,p as u}from"./index-BgjiYeva.js";const k=j("project",()=>{const o=d([]),c=d(""),s=d(!1),i="audio-editor-projects",v=u(()=>o.value.find(t=>t.id===c.value)),p=u(()=>o.value.length>0),n=()=>{try{localStorage.setItem(i,JSON.stringify(o.value))}catch(t){console.error("保存项目到本地存储失败:",t)}},l=()=>{try{const t=localStorage.getItem(i);if(t){const r=JSON.parse(t);o.value=r.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}}catch(t){console.error("从本地存储加载项目失败:",t),o.value=[]}};return{projects:o,currentProjectId:c,isSaving:s,currentProject:v,hasProjects:p,createProject:(t,r="")=>{const e={id:Date.now().toString(),name:t,description:r,createdAt:new Date,updatedAt:new Date,tracks:[],settings:{outputFormat:"mp3",sampleRate:44100,bitRate:128,channels:2}};return o.value.push(e),c.value=e.id,n(),e.id},loadProject:t=>{const r=o.value.find(e=>e.id===t);return r?(c.value=t,r):null},saveProject:async t=>{s.value=!0;try{const r=o.value.findIndex(e=>e.id===t.id);r>-1&&(t.updatedAt=new Date,o.value[r]=t,n()),await new Promise(e=>setTimeout(e,500))}finally{s.value=!1}},deleteProject:t=>{var e;const r=o.value.findIndex(a=>a.id===t);r>-1&&(o.value.splice(r,1),c.value===t&&(c.value=((e=o.value[0])==null?void 0:e.id)||""),n())},updateProjectSettings:(t,r)=>{const e=o.value.find(a=>a.id===t);e&&(e.settings={...e.settings,...r},e.updatedAt=new Date,n())},addTrackToProject:(t,r)=>{const e=o.value.find(a=>a.id===t);e&&!e.tracks.includes(r)&&(e.tracks.push(r),e.updatedAt=new Date,n())},removeTrackFromProject:(t,r)=>{const e=o.value.find(a=>a.id===t);if(e){const a=e.tracks.indexOf(r);a>-1&&(e.tracks.splice(a,1),e.updatedAt=new Date,n())}},exportProject:async t=>{const r=o.value.find(e=>e.id===t);if(!r)throw new Error("项目不存在");return{project:r,timestamp:new Date().toISOString()}},init:()=>{l()},clearAllProjects:()=>{o.value=[],c.value="",localStorage.removeItem(i)},saveToLocalStorage:n,loadFromLocalStorage:l}});export{k as u};
